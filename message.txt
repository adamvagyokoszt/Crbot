const Discord = require("discord.js");
const tokenfile = require("./tokenfile.json");
const botconfig = require("./botconfig.json");
const bot = new Discord.Client({disableEveryone: true});
const fs = require("fs");
const money = require("./money.json")
var weather = require('weather-js');

let botname = "DreamBotğŸ„"

bot.on("ready", async() => {
    console.log(`${bot.user.username} sikeresn elindult!`)

    let stÃ¡tuszok = [
        `${bot.guilds.cache.size}  szerver`,
        "Prefix: -",
        "-help",
        "FejlesztÅ‘: ARON_"
    ]

    setInterval(function() {
        let status = stÃ¡tuszok[Math.floor(Math.random()* stÃ¡tuszok.length)]

        bot.user.setActivity(status, {type: "WATCHING"})
    }, 5000)
})

bot.on("message", async message => {
    let MessageArray = message.content.split(" ");
    let cmd = MessageArray[0];
    let args = MessageArray.slice(1);
    let prefix = botconfig.prefix;

    if(!money[message.author.id]){
        money[message.author.id] = {
            money: 200

        };
    }
    fs.writeFile("./money.json", JSON.stringify(money), (err) => {
        if(err) console.log(err);
    });
    let selfMoney = money[message.author.id].money;

    if(cmd === `${prefix}pÃ©nzegyenleg`){
        let profilkep = message.author.displayAvatarURL();

        let MoneyEmbed = new Discord.MessageEmbed()
        .setAuthor(message.author.username)

        .setColor("GREEN")

        .addField("Egyenleged:", `${selfMoney}FT`)

        .setThumbnail(profilkep)

        .setFooter(`${botname} | ${message.createdAt} | ${bot.users.cache.size}.Tag`)

        message.channel.send(MoneyEmbed)
    }

    if(cmd === `${prefix}ingyenpÃ©nz`){
        message.channel.send("500FT ot kaptÃ¡l!")
        money[message.author.id] = {
            money: selfMoney + 500
        }
    }

    if(cmd === `${prefix}pÃ©nzadd`){
        if (!message.member.hasPermission("BAN_MEMBERS")) return message.reply("HIBA! **Nincs jogod ehhez a parancshoz! SzÃ¼ksÃ©ges jog:** `PÃ©nz add!`")
        message.channel.send("Sikeresen addoltÃ¡l!")
        money[message.author.id] = {
            money: selfMoney + 10000
        }
    }

    if(cmd === `${prefix}weather`){
        if(args[0]){
            weather.find({search: args.join(" "), degreeType: "C"}, function(err, result) {
                if (err) message.reply(err);

                if(result.length === 0){
                    message.reply("KÃ©rlek adj meg egy lÃ©tezÅ‘ telepÃ¼lÃ©s nevet!")
                    return;
                }

                let current = result[0].current;
                let location = result[0].location;

                let WeatherEmbed = new Discord.MessageEmbed()
                .setDescription(`**${current.skytext}**`)
                .setAuthor(`IdÅ‘jÃ¡rÃ¡s itt: ${current.observationpoint}`)
                .setThumbnail(current.imageUrl)
                .setColor("GREEN")
                .addField("IdÅ‘zÃ³na:", `UTC${location.timezone}`, true)
                .addField("Fokozat tÃ­pusa:", `${location.degreetype}`, true)
                .addField("HÅ‘fok", `${current.temperature}Â°C`, true)
                .addField("HÅ‘Ã©rzet:", `${current.feelslike}Â°C`, true)
                .addField("SzÃ©l", `${current.winddisplay}`, true)
                .addField("PÃ¡ratartalom:", `${current.humidity}%`, true)

                message.channel.send(WeatherEmbed);
            })

        } else {
            message.reply("KÃ©rlek adj meg egy telepÃ¼lÃ©s nevet!")
        }
    }

    if(cmd === `kosÃ¡r`){
        message.channel.send("labdağŸ€");
    }

    if(cmd === `invite`){
        message.channel.send("https://discord.com/api/oauth2/authorize?client_id=920353528118124544&permissions=8&scope=bot \n Szia! Ez lenne az Ã©n invite linkem DreamBotğŸ„")
    }

    if(cmd === `sziabot`){
        message.channel.send(`szia!`)
    }
    
    if(cmd === `supportszerver`){
        message.channel.send("https://discord.gg/etqMepaenv")
    }

    if(cmd === `${prefix}botping`) {
        message. channel. send("Pinging..."). then(m =>{
        var ping = m. createdTimestamp - message. createdTimestamp;
        var botPing = Math. round(bot. pi);
        m.edit(`ğŸ“¡DreamBot pingje:\n ${ping}ms`);
        });
      }

      if(cmd === `${prefix}servergep`){
        let = message.author.displayAvatarURL();

        let GepEmbed = new Discord.MessageEmbed()
        .setAuthor(message.author.username)

        .setColor("GREEN")

        .addField("Ram:", `AMD ryzen 5 3600x`)

        .addField("VideÃ³kÃ¡rtya", `ASUS rog strix 2060`)

        .addField("Ram", `2x8gb`)
        
        .addField("Alaplap", `ASUS rog strix b450f`)

        .addField("BOT", `v12.5.3`)

        .setFooter(`${botname} | ${message.createdAt} | ${bot.users.cache.size}.Tag`)

        message.channel.send(GepEmbed)
    }

    if(cmd === `${prefix}say`){
        let szÃ¶veg = args.join(" ");

        if(szÃ¶veg) {
            let Embed = new Discord.MessageEmbed()
        .setColor("GREEN")

        .setAuthor(message.author.username)

        .addField("SzÃ¶veg:", szÃ¶veg)

        .setFooter(`${botname} | ${message.createdAt}`)
    
        message.channel.send(Embed)
        } else {
            message.reply("Ã­rj say szÃ¶veget!")
        }
    }

    
    if(cmd === `${prefix}Ã¶tlet`){
        let szÃ¶veg = args.join(" ");

        if(szÃ¶veg) {
            let Embed = new Discord.MessageEmbed()
        .setColor("GREEN")

        .setAuthor(message.author.username + `|Ã–tletett kÃ¶ldÃ¶ttğŸ§±`)

        .addField("SzÃ¶veg:", szÃ¶veg)

        .setFooter(`${botname} | ${message.createdAt}`)
    
        message.channel.send(Embed)
        } else {
            message.reply("Ã­rj Ã¶tletet !")
        }
    }

    if(cmd === `${prefix}parancsok`){
        let DreamBotEmbed = new Discord.MessageEmbed()

        .setColor("GREEN")

        .setTitle("**ğŸ„DreamBotğŸ„**")

        .addField("Parancsok:", "`kosÃ¡r labda parancsğŸ€`\n \n `parancsok parancsğŸ“‘`\n \n`Ã¶tletek parancsğŸ§±` \n \n `say parancsğŸ“‘` \n \n `banXkick parancsğŸš¨` \n \n`botping parancsğŸ“¡` \n \n`clear parancsğŸ§¹` \n \n`invite parancsğŸ’»` \n \n`help parancs` \n \n`sziabot parancsğŸ–` \n \n `[ECONOMY] ingyenpÃ©nz parancsğŸ’¸` \n \n `[ECONOMY] pÃ©nzegyenleg parancsğŸ’¸` \n\n `[ECONOMY]pÃ©nzaddğŸ’¸` \n\n `supportszerver parancsğŸ’»` \n\n `servergep parancsğŸ’»`\n\n `weather parancsğŸŒµ`")

        .setDescription("**Itt lÃ¡thatÃ³ a botban lÃ©vÅ‘ Ã¶sszes parancs!ğŸ„**")

        .setFooter(`${botname} | ${message.createdAt} | ${bot.users.cache.size}.Tag`)

        message.channel.send(DreamBotEmbed)
    }

    if(cmd === `${prefix}help`){
        let DreamBotEmbed = new Discord.MessageEmbed()

        .setColor("GREEN")

        .addField(`\`https://discord.gg/etqMepaenv\``, "**SUPPORT SZERVER**")

        .addField(`\`-parancsok\``, "** A DreamBot-ban lÃ©vÅ‘ parancsok!**")

        .addField(`\`invite\``, "** A DreamBot invite-linkje**")

        .setFooter(`${botname} | ${message.createdAt}`)

        message.channel.send(DreamBotEmbed)
    }

    if (cmd === `${prefix}clear`) {
        if (message.member.permissions.has('KICK_MEMBERS')) {
            if(message.guild.member(bot.user).hasPermission("ADMINISTRATOR"))

            if (args[0] && isNaN(args[0]) && args[0] <= 100 || 0 < args[0] && args[0] < 101) {

                

                let clearEmbed = new Discord.MessageEmbed()
                .setTitle(`TÃ¶rÃ¶lve lett ${Math.round(args[0])} Ãœzenet a szobÃ¡bÃ³l! ğŸ§¹`)
                .setColor("GREEN")
                .setAuthor(message.author.username)
                .setTimestamp()

                message.channel.send(clearEmbed);


                message.channel.bulkDelete(Math.round(args[0]))


            }
        }
    }
    
    ///////////////////////BANxKICK///////////////////////

    if(cmd === `${prefix}ban`) {
        let user = message.mentions.members.first() || message.guild.members.cache.get(args[0]);
        let rawreason = args[2];
        let bantime = args[1];
        let reason = args.slice(2).join(' ')
        if (!message.member.hasPermission("BAN_MEMBERS")) return message.reply("HIBA! **Nincs jogod ehhez a parancshoz! SzÃ¼ksÃ©ges jog:** `Tagok kitiltÃ¡sa!`")
        if(!args[0] || !args[1] || !args[2] || isNaN(bantime)) return message.reply("HIBA! **Helyes hasznÃ¡lat: {prefix}ban <@felhasznÃ¡lÃ³> [idÅ‘{(nap) max 7} <indok>**");
        if (user.hasPermission("BAN_MEMBERS") || user.hasPermission("ADMINISTRATOR")) return message.reply("HIBA! **Magaddal egyen rangÃº tagot, vagy nagyobbat nem bannolhatsz ki!**");
        if(user.ban({days: bantime, reason: reason})) {
            message.reply("**Sikeresen kitiltottad a kÃ¶vetkezÅ‘ felhasznÃ¡lÃ³t:** (" + user.user.tag + ")")
        } else {
            message.reply("HIBA! **Nincs jogom bannolni ezt az embert.**");
        }
    }

    if(cmd === `${prefix}kick`){
        if (!message.member.hasPermission("KICK_MEMBERS")) return message.reply("HIBA! **Nincs jogod ehhez a parancshoz! SzÃ¼ksÃ©ges jog:** `Tagok kirÃºgÃ¡sa!`")
        let kick_user = message.mentions.members.first();
        if(args[0] && kick_user){

            if(args[1]){

                let KickEmbed = new Discord.MessageEmbed()
                .setTitle("KICK")
                .setColor("GREEN")
                .setDescription(`**Kickelte:** ${message.author.tag}\n**Kickelve lett:** ${kick_user.user.tag}\n**Kick indoka:** ${args.slice(1).join(" ")}`)

            message.channel.send(KickEmbed);

                kick_user.kick(args.slice(1).join(" "));

            } else {
            let parancsEmbed = new Discord.MessageEmbed()
            .setTitle("Parancs hasznÃ¡lata:")
            .addField(`\`${prefix}kick <@nÃ©v> [indok]\``, "DreamBot")
            .setColor("GREEN")
            .setDescription("HIBA: KÃ©rlek adj meg egy indokot!!")

            message.channel.send(parancsEmbed);
            }

        } else {
            let parancsEmbed = new Discord.MessageEmbed()
            .setTitle("Parancs hasznÃ¡lata:")
            .addField(`\`${prefix}kick <@nÃ©v> [indok]\``, "DreamBot")
            .setColor("GREEN")
            .setDescription("HIBA: KÃ©rlek emlÃ­ts meg egy embert!")

            message.channel.send(parancsEmbed);

        }
    }

})

bot.login(tokenfile.token);